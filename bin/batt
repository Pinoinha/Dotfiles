#!/bin/env dash

batt() {
	batt="$(acpi | awk '{print $4}' | sed -e 's/%,//g')"
	state="$(cat /sys/class/power_supply/BAT0/status)"

	# resets when the script is called again
	notif=0

	icon=""

	if [ "$state" -eq "Discharging" ]; then

		[ "$batt" -le 7 ] && icon=""  && [ notif -eq 0 ] && notify-send -u critical 'Bateria crítica!' 'Bateria atingiu 7%' && "$notif"=1

		[ "$batt" -ge 7 ] && [ "$batt" -le 10 ] && icon="" && [ "$notif" -eq 0 ] && notify-send 'Bateria descarregando' 'Bateria atingiu 10%' && "$notif"=1

		[ "$batt" -ge 10 ] && [ "$batt" -le 20 ] && icon="" && [ "$notif" -eq 0 ] && notify-send 'Bateria descarregando' 'Bateria atingiu 20%' && "$notif"=1

		[ "$batt" -ge 20 ] && [ "$batt" -le 50 ] && icon="" 

		[ "$batt" -le 96 ] && [ "$batt" -ge 90 ] && icon="" 

		[ "$batt" -ge 96 ] && icon="" 

	elif [ "$state" -eq "Charging" ]; then
		icon=""

		[ "$batt" -ge 98 ] && notify-send 'Bateria completamente carregada!' 'Bateria alcançou 100%' && icon=""
	fi

	printf "%s %d%%" "$icon" "$batt"
}

batt
